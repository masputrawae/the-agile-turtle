---
import type { HTMLAttributes } from 'astro/types'
import { Icon } from 'astro-icon/components'
import { config } from '../site.config.ts'

const basePath = import.meta.env.BASE_URL
const baseUrl = import.meta.env.SITE
const pathname = Astro.url.pathname

const { siteTitle } = config

export const links: HTMLAttributes<'a'>[] = [
	{
		name: 'Home',
		href: '/'
	},
	{
		name: 'About',
		href: '/about/'
	},
	{
		name: 'Blog',
		href: '/blog/'
	},
	{
		name: 'Tags',
		href: '/tags/'
	},
	{
		name: 'Projects',
		href: '/projects/'
	}
]
---

<header
	class:list={[
		'relative flex min-h-16 items-center justify-between px-4 py-2',
		'border-b border-neutral-200',
		'dark:border-neutral-700',
		'md:border-none'
	]}
>
	<a
		transition:persist
		href={new URL(basePath, baseUrl)}
		class:list={[
			'text-xl font-semibold text-neutral-950 hover:text-amber-600',
			'dark:text-neutral-50 dark:hover:text-amber-400',
			'md:text-2xl'
		]}
	>
		{siteTitle}
	</a>

	<nav
		id="navbar"
		class:list={[
			'absolute start-0 top-full flex w-full origin-top flex-col gap-2 bg-neutral-50 px-4 py-4',
			'hidden scale-y-0 transition-all duration-300',
			'border-y border-neutral-200',
			'dark:border-neutral-700 dark:bg-neutral-800'
		]}
	>
		{
			links.map(({ name, href }) => {
				const isCurrent = href === pathname
				const isAncestor = pathname.startsWith(String(href)) && href !== basePath
				const isActive = isCurrent || isAncestor
				return (
					<a
						href={href}
						class:list={[isActive && 'text-amber-600 dark:text-amber-400', 'flex items-center']}
						{...(isCurrent
							? { 'aria-current': 'page' }
							: isAncestor
								? { 'aria-current': 'true' }
								: {})}
					>
						{name}
					</a>
				)
			})
		}
	</nav>

	<div class="flex items-center gap-4">
		<button id="toggle-theme">
			<Icon size={20} name="bi:moon-stars-fill" id="icon-dark-mode" />
			<Icon size={20} name="bi:sun" id="icon-light-mode" class="hidden" />
		</button>
		<button id="toggle-navbar">
			<Icon size={20} name="bi:menu-button-wide-fill" id="icon-navbar-open" />
			<Icon size={20} name="bi:x-lg" id="icon-navbar-close" class="hidden" />
		</button>
	</div>
</header>
